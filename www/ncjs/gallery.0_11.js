(function(){var lib=page;var geom=exports.GEOM2D;var imlib=exports.IMAGE;var com=idv.common;var util=idv.util;lib.hasTag=function(im,tag){var tags=im.tags;if(!tags||(tags.length==0))return tag=="other"; var rs=$.inArray(tag,tags)>=0;return rs;}
lib.genTab=function(container,cb){var tabCss={'border-radius':'0px','margin-left':'0px','margin-right':'0px','margin-bottom':'0px','padding-left':'15px','padding-right':'15px','border':'solid thin black','padding-bottom':'4px'};var tabSelectedCss=util.extend(util.copy(tabCss),{"background-color":"#dddddd","color":"black"})
var tabDeselectedCss=util.extend(util.copy(tabCss),{"background-color":"#303132","color":"white"})
var tabDiv=$('<div class="tabDiv"></div>')
container.append(tabDiv);lib.tabDiv=tabDiv;var showArt=$('<span class="clickableElement">Art</span>');var showOther=$('<span class="clickableElement">Other</span>');var tabGroup=new lib.clickableGroup([['art',showArt],['other',showOther]],tabSelectedCss,tabDeselectedCss,cb);tabGroup.appendTo(tabDiv);return tabGroup;}})();
(function(){var lib=page;var geom=exports.GEOM2D;var imlib=exports.IMAGE;var com=idv.common;var util=idv.util;lib.toAlbum=function(im,aid){var tp=im.topic;var tps=tp.split("/");var imname=tps[tps.length-1];return"/album/"+imname+"/"+aid;}
lib.largeImDiv=function(container,imD,impairD,album){this.container=container;this.imD=imD;this.impairD=impairD;this.album=album;}
lib.imageTopic=function(usr,imname){return"/image/"+usr+"/"+imname;}
lib.albumTopic=function(usr,imname,albumNum){return"/album/"+usr+"/"+imname+"/"+albumNum;}
lib.whichGallery='art';lib.renderAlbum=function(tp){var alb=idv.data.albums[tp];var imtp=alb.image;var im=idv.data.images[imtp];if(lib.hasTag(im,lib.whichGallery)){var imdiv=new lib.largeImDiv(lib.cDiv,im,null,alb);imdiv.render();}}
lib.largeImDiv.prototype.renderImpair=function(){ var cnt=this.container;var impairD=this.impairD;var im0=impairD.image0;var im1=impairD.image1;var imD0=lib.images.cg_astoria_1923_1; var imD1=lib.images.cg_astoria_2010_1; var title="Astoria in 1923 and 2010 with coordinated zooming/panning"; var imUrl0=imD0.imUrl;var imUrl1=imD1.imUrl;var tp=imD0.topic;var sp=tp.split("/");var imname=sp[3]; var uname=sp[2];var s3d="http://"+idv.cfDomain+"/resized/";var imUrl0=s3d+imname+".jpg";var tp=imD1.topic;var sp=tp.split("/");var imname=sp[3]; var uname=sp[2];var imUrl1=s3d+imname+".jpg";var dim0=geom.internalizePoint(imD0.untiledDimensions);var dim1=geom.internalizePoint(imD1.untiledDimensions); var aspectRatio=dim0.x/dim0.y;this.aspectRatio=aspectRatio;this.imRelWd=0.8;var ht0percent=Math.floor(100*dim0.y/dim0.x)+"%";var ht1percent=Math.floor(100*dim1.y/dim1.x)+"%";var theDivStack=lib.theDivStack;var titleDiv=$('<div class="largeImTitle"/>');cnt.append(titleDiv);var titleP=$('<p/>')
titleP.html(title);cnt.append(titleDiv);titleDiv.append(titleP);titleDiv.click(function(){util.navigateToPage("/topic"+impairD.topic+"/index.html");});var imDiv=$('<div class="largeImDiv"/>');cnt.append(imDiv);imDiv.click(function(){location.href="/topic"+impairD.topic;});var imEl0='<img class="galleryImage" width="100%"  src="'+imUrl0+'"/>';var imEl0=$(imEl0);this.imEl0=imEl0;var imEl1='<img class="galleryImage" width="100%" src="'+imUrl1+'"/>';var imEl1=$(imEl1);this.imEl1=imEl1;imDiv.append(imEl0);imDiv.append(imEl1);lib.thePics.push(this);this.setImHeight();}
lib.largeImDiv.prototype.setImHeight=function(){var ly=lib.theLayout;var divWd=ly.vpCss.width;var imWd=this.imRelWd*divWd;var imHt=imWd/this.aspectRatio;if(this.imEl0){this.imEl0.height(imHt);this.imEl1.height(imHt);}else{this.imEl.height(imHt);}}
lib.largeImDiv.prototype.render=function(){var ly=lib.theLayout;var divWd=ly.vpCss.width;var cnt=this.container;var imD=this.imD;var impairD=this.impairD;if(impairD){return this.renderImpair();}
var title=imD.title;var name=imD.name; var author=imD.author;if(author){author=", "+author;}else{author="";}
if(!title){title=name;}
title=title+author;var album=this.album;if(album){var cp=album.caption;if(cp){title=title+":"+cp;}
var theTopic=album.topic;}else{theTopic=imD.topic;}
var tp=imD.topic;var sp=tp.split("/");var imname=sp[3]; var uname=sp[2];var s3d="http://"+idv.cfDomain+"/images/";var imUrl=s3d+uname+"/"+imname+"/resized/area_250000.jpg";var albUrl=util.publishedUrl(album.topic);var dim=geom.internalizePoint(imD.untiledDimensions);var htPercent=Math.floor(100*dim.y/dim.x)+"%";var aspectRatio=dim.x/dim.y;
var titleDiv=$('<div class="largeImTitle"/>');var titleP=$('<p/>')
titleP.html(title);cnt.append(titleDiv);titleDiv.append(titleP);titleDiv.click(function(){util.navigateToPage(albUrl);});if(aspectRatio<2){var imDiv=$('<div class = "squareImDiv"/>')
var imRelWd=0.4;}else{var imDiv=$('<div class="largeImDiv"/>');imRelWd=0.8;}
this.aspectRatio=aspectRatio;this.imRelWd=imRelWd;imDiv.click(function(){util.navigateToPage(albUrl);});var imEls='<img class="galleryImage" width="100%"  src="'+imUrl+'"/>';var imEl=$(imEls);this.imEl=imEl;this.setImHeight();lib.thePics.push(this);imDiv.append(imEl);cnt.append(imDiv);}
lib.genDivs=function(){var fullTitle="<i>the depths of high-resolution images, annotated</i>";var b=$('body');var topbarOptions={title:fullTitle};var outerDiv=$(".outerDiv");lib.topDiv=imlib.genTopbar(outerDiv,topbarOptions);lib.outerDiv=outerDiv;var cb=function(nm){lib.whichGallery=nm;lib.renderContents();}
lib.tabGroup=lib.genTab(outerDiv,cb);var cDiv=$("<div class='galleryDiv'/>");cDiv.css("background-color","black");lib.cDiv=cDiv;outerDiv.append(cDiv);if(false){lib.noteDiv=$('<div class="noteDiv"><p> See the <span id="galleryLink">gallery</span> for a few more images</p>'+'<p style="line-height:10px;top:0px;width:100%;text-align:center">Astoria in 1923</p></div>');b.append(lib.noteDiv);$('#galleryLink').click(function(){util.navigateToPage("/gallery.html");});lib.noteSdiv.element=lib.noteDiv;}
cDiv.append(lib.bottomDiv);lib.theLayout=new lib.LayoutZero({outerDiv:lib.outerDiv,tabDiv:lib.tabDiv,centerDiv:lib.cDiv,margin:50,minScale:0.6,aspectRatio:1, maxScale:1});}
lib.renderContents=function(){lib.cDiv.empty();var albs=idv.data.albumList;var ln=albs.length;for(var i=0;i<ln;i++){alb=albs[i];lib.renderAlbum(alb);}
lib.cDiv.append('<div style="width:100;height:50px"></div>');}
lib.initialize=function(options){idv.loggedInUser=options.loggedInUser;lib.genDivs();lib.theLayout.placeDivs();lib.thePics=[];lib.theLayout.afterPlacement=function(){if(lib.thePics){var ln=lib.thePics.length;for(var i=0;i<ln;i++){var pic=lib.thePics[i];pic.setImHeight();}}};var cDiv=lib.cDiv;var tabDiv=$('<div></div>')
lib.renderContents();lib.tabGroup.selectElement("art");lib.theLayout.placeDivs();$(window).resize(function(){util.log("resize",$(window).width());lib.theLayout.placeDivs();});return;}})();

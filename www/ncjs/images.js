
(function(){var lib=page;var geom=idv.geom;var imlib=idv.image;var com=idv.common;var util=idv.util;lib.createAlbumWd=450;lib.editAlbumDiv=$('<div class="editAlbumDiv">'+'<div id="note">Note: these fields are optional, and can be edited later via "image details/ Edit"  </div>'+'<hr/>'+'<div class="albumFields">'+'<div id="editAlbumExplanation" style="text-align:center;margin-bottom:10px"></div>'+'<table id="albumFields">'+'<tr><td class="inputsTD">Title<td><td><input size="40" id="albumCaption" value="Untitled" type="text"/></td></tr>'+'<tr><td class="inputsTD"></td><td></td><td>To include links or other formatting in the description, use   <a href="http://daringfireball.net/projects/markdown/basics" target="idvWindow">Markdown</a></i></td></tr>'+'<tr><td class="inputsTD">Description<td><td><textarea rows="6" cols="50" id="albumDescription"/></td></tr>'+
'</table>'+'</div>'+'</table>'+'<div id="editAlbumButtons" class="buttonLine">'+'<span id="submitAlbum" class="clickableElement">Save</span>'+'<span id="cancelAlbum" class="clickableElement">Cancel</span>'+'</div>'+'</div>');lib.deleteAlbumDiv=$('<div id="deleteAlbum">'+'<div class="areYouSure">Are you sure you wish to delete this album, and its snapshots? There is no undo.</div>'+'<div>'+'<span  style="margin-left:20px" id="yesDeleteAlbum" class="clickableElement">Yes, Delete</span>'+'<span   id="noDontDeleteAlbum" style="margin-left:30px"  class="clickableElement">Cancel</span>'+'</div>'+'</div>');lib.createAlbumJsonP=function(imTopic,cb){var data={image:imTopic};var url="http://"+idv.apiHost+"/api/newAlbumJsonP";util.getJsonP(url,data,function(rs){cb(rs.value);});}
lib.deleteTheAlbum=function(){var data={topic:lib.albumD.topic};var url="/api/deleteAlbum";var imtp=lib.albumD.image.topic;util.post(url,data,function(rs){if(rs.status!="ok"){util.logout();location.href="/timeout";return;}
location.href="/mywork";},"json");util.log("api","uuuuu");}
lib.editAlbumFields=function(){var caption=$('#albumCaption',lib.editAlbumDiv).attr('value');var ds=$('#albumDescription',lib.editAlbumDiv).attr('value');var data={caption:caption,description:ds,topic:lib.albumD.topic};var url="/api/editAlbum";util.post(url,data,function(rs){lib.albumD.caption=data.caption;lib.albumD.description=data.description;lib.updateTopbarOptions(lib.topbar.options);lib.topbar.render()
lib.lightbox.dismiss();});}
lib.popEditAlbumLightbox=function(){lib.lightbox.pop();lib.lightbox.element.empty();lib.editAlbumDiv.css({"margin":"20px"});lib.lightbox.addClose();lib.albumD.caption='Untitled';lib.lightbox.element.append(lib.editAlbumDiv);$('#submitAlbum',lib.editAlbumDiv).click(function(){lib.editAlbumFields();});$('#cancelAlbum',lib.editAlbumDiv).click(function(){lib.lightbox.dismiss();});return;}
lib.showAlbumChoice=function(albums,im){var tp=im.topic;if(!albums||(albums.length==0)){var tpo=new util.topicOb(tp);tpo.albumId="-";tpo.kind="album";var atp=tpo.topic();var dst="http://"+idv.apiHost+idv.topicDir+atp+"/index.html";location.href=dst;return;}
var msg=$('<div id="lightboxMessage"/>');msg.css({'margin':'30px'});msg.append('<div>These are your albums of annotations of <i>'+util.imTitle(im)+'</i>:</div>');util.arrayForEach(albums,function(a){var abc=22;var ael=$('<div>').html(a.caption).css({'margin-top':'10px','margin-left':'20px','text-decoration':'underline','cursor':'pointer'});var dst="http://"+idv.apiHost+idv.topicDir+(a.topic)+'/index.html';ael.click(function(){location.href=dst;})
msg.append(ael);});util.addButton(msg,"Create New Album",function(){lib.createAlbumJsonP(tp,function(atp){var dst="http://"+idv.apiHost+idv.topicDir+atp+"/index.html?new=1";location.href=dst;});},true).css({"margin-top":"20px"});lib.lightbox.popMessage(msg);}
lib.popAlbumChoice=function(im){var tp=im.topic;if(!idv.loggedInUser){var tpo=new util.topicOb(tp);var url=idv.topicDir+"/album/"+tpo.imageOwner+"/"+tpo.imageName+"/-/index.html";location.href=url;return;}
var url="http://"+idv.apiHost+"/api/albumsForImageJsonP";var data={image:tp};util.getJsonP(url,data,function(rs){var albums=rs.value;lib.showAlbumChoice(albums,im);})}})();
(function(){var lib=page;var geom=idv.geom;var imlib=idv.image;var com=idv.common;var util=idv.util;lib.hasTag=function(im,tag){var tags=im.tags;if(!tags||(tags.length==0))return tag=="other"; var rs=$.inArray(tag,tags)>=0;return rs;}
lib.genTab=function(container,cb,title){var tabCss={'border-radius':'0px','margin-left':'0px','margin-right':'0px','margin-bottom':'0px','padding-left':'15px','padding-right':'15px','border':'solid thin black','padding-bottom':'4px'};var tabSelectedCss=util.extend(util.copy(tabCss),{"background-color":"#dddddd","color":"black"})
var tabDeselectedCss=util.extend(util.copy(tabCss),{"background-color":"#303132","color":"white"})
var tabDiv=$('<div class="tabDiv"></div>')
container.append(tabDiv);lib.tabDiv=tabDiv;var showArt=$('<span class="clickableElement">Art</span>');var showOther=$('<span class="clickableElement">Other</span>');if(title){var titleEl=$('<span></span>').html(title);titleEl.css({"font-weight":"bold","width":"100%","text-align":"center","float":"right"});tabDiv.append(titleEl);}
var tabGroup=new lib.clickableGroup([['art',showArt],['other',showOther]],tabSelectedCss,tabDeselectedCss,cb);tabGroup.appendTo(tabDiv);return tabGroup;}})();
(function(){var lib=page;var geom=idv.geom;var imlib=idv.image;var com=idv.common;var util=idv.util;lib.whichGallery="art";lib.genDivs=function(){var fullTitle="<i>the depths of high resolution images, annotated</i>";var b=$('body');var topbarOptions={title:fullTitle};var outerDiv=$(".outerDiv");lib.topDiv=idv.topbar.genTopbar(outerDiv,topbarOptions);lib.outerDiv=outerDiv;b.append(outerDiv);var cb=function(nm){lib.whichGallery=nm;lib.renderContents();}
lib.tabGroup=lib.genTab(outerDiv,cb,"Images: click on any image to annotate it");var cDiv=$("<div class='imagesDiv'/>");cDiv.css({"position":"relative","background-color":"black"});lib.cDiv=cDiv;outerDiv.append(cDiv);cDiv.append(lib.bottomDiv);lib.theLayout=new lib.LayoutZero({outerDiv:lib.outerDiv,centerDiv:lib.cDiv,margin:50,minScale:0.6,aspectRatio:1, maxScale:1,includeLightbox:1});}
lib.cimTop=0;lib.cimLeft=0;lib.imDiv=undefined;lib.imHeight=130;lib.maxImWd=400;lib.titleHt=60; lib.imPaddingY=50; lib.imPaddingX=20;lib.minImWd=220;lib.imEls=[];lib.imDivs=[];lib.cntEls=[];lib.maxTitleChars=30;lib.goToSnaps=function(im){var url="/api/newAlbum";var data={"image":im.topic,"caption":".snaps."}
util.post(url,data,function(rs){var atp=rs.value;var aurl="/topic"+atp+"/index.html";location.href=aurl;});}
lib.truncate=function(s,mx){var ln=s.length; if(ln>mx){var ssp=s.split(" ");var rs="";var sln=ssp.length;for(i=0;i<sln;i++){var cw=ssp[i];var cln=rs.length;var wln=cw.length;if((cln+wln)>mx-3){rs+="..."
return rs;}
rs+=cw+" ";}}
return s;}
lib.addPic=function(im){var tp=im.topic;var albs=im.albums;var acnt=albs?albs.length:0;
lib.shownImages.push(im);var ttl=im.title;if(!ttl){ttl=im.name;}
ttl=lib.truncate(ttl,lib.maxTitleChars);var tps=tp.split("/");var imo=tps[2];var imname=tps[3];var imdim=im.dimensions;var arti=(imdim.x)/(imdim.y);var ht=lib.imHeight;var wd=Math.max(Math.ceil(ht*arti),lib.minImWd);if(wd>lib.maxImWd){ht=ht*(lib.maxImWd/wd);wd=lib.maxImWd;}
var imdiv=$('<div/>');var imdivht=lib.imHeight+lib.titleHt+20;imdiv.css({"position":"absolute","height":imdivht+"px","width":wd+"px"});lib.imDiv.append(imdiv);var ttldiv=$('<div/>');ttldiv.css({"text-align":"center","font-size":"8pt"});ttldiv.html(ttl);imdiv.append(ttldiv);if(im.author){var authordiv=$('<div/>');authordiv.css({"margin-top":"5px","font-style":"italic","text-align":"center","font-size":"8pt"});authordiv.html(lib.truncate(im.author,lib.maxTitleChars));imdiv.append(authordiv);}
var dimsdiv=$('<div/>');dimst=imdim.x+" x "+imdim.y;dimsdiv.html(dimst);dimsdiv.css({"text-align":"center","font-size":"8pt","margin-top":"5px"});imdiv.append(dimsdiv);var imsrc=util.s3imDir(imo,imname)+"resized/height_100.jpg";var imsrc=util.s3imDir(imo,imname)+"resized/area_50000.jpg";var thelink="/topic/image/"+imo+"/"+imname+"/index.html";var imel=$('<img src="'+imsrc+'"/>');imel.css({"cursor":"pointer"});var imwd=((imdim.x)/(imdim.y))*ht;imel.attr("width",imwd);imel.attr("height",ht);imel.css({"position":"absolute","cursor":"pointer"});imdiv.append(imel);(function(iim){imdiv.click(function(){lib.popAlbumChoice(iim);});})(im);lib.imDivs.push(imdiv);lib.imEls.push(imel);return;var cntel=$('<div style="position:absolute"/>');var uniqueAlbum=true;if(ia){if(acnt==1){var alb=albs[0];var cap=alb.caption;if(cap){var htm="1 album: "+cap;}else{htm="1 album";}
cntel.html(htm);cntel.css({"text-decoration":"underline","cursor":"pointer"});var tp=alb.topic;thelink="http://s3.imagediver.org/topic"+tp+"/index.html";cntel.click(function(){location.href=thelink;});imel.click(function(){location.href=thelink;});}else if(acnt==0){cntel.html("no albums");}else{if(alb){var tp=alb.topic;alink="http://s3.imagediver.org/topic"+tp+"/index.html";uniqueAlbum=false;var fts=$('<div/>');cntel.append(fts);var cap=alb.caption;if(cap){var htm="Featured : "+cap;}else{htm="featured album";}
fts.html(htm);fts.css({"text-decoration":"underline","cursor":"pointer"})
fts.click(function(){location.href=alink;});var rst=$('<div/>');rst.html((acnt-1)+" more albums");cntel.append(rst);}else{cntel.html(acnt+" albums");cntel.click(function(){lib.popAlbumChoice(im);})
imel.click(function(){lib.popAlbumChoice(im);})}}}else{var tpo=new util.topicOb(tp);tpo.albumId="-";tpo.kind="album";var atp=tpo.topic();var dst="http://"+idv.apiHost+"/topic"+atp+"/index.html";imdiv.click(function(){location.href=dst;});}
cntel.css({"width":wd+"px","text-align":"center","text-decoration":"underline","cursor":"pointer"});imdiv.append(cntel);lib.imDivs.push(imdiv);lib.imEls.push(imel);lib.cntEls.push(cntel);}
lib.addPics=function(){lib.imDiv.empty();var ln=lib.images.length; function authorLastName(im){var a=im.author;if(!a){return"zzz"}
a=a.toLowerCase();var sp=a.split(" ");var ln=sp.length;if((ln>2)&&sp[ln-2]=="the"&&(sp[ln-1]=="elder"||sp[ln-1]=="younger")){var rs=sp[ln-3];}else{rs=sp[ln-1];}
if(a.indexOf("Bronzino")>=0)
console.log(a,"=",rs);return rs;};util.arrayForEach(lib.images,function(im){im.aname=authorLastName(im);});function imarea(im){var dim=im.dimensions;return dim.x*dim.y;}
var compare=function(im1,im2){var a1=im1.aname;var a2=im2.aname;return(a1<a2)?-1:1;}
lib.images.sort(compare);for(var i=0;i<ln;i++){var cim=lib.images[i];lib.addPic(cim);}
lib.picsAdded=true;}
lib.placePics=function(){if(!lib.picsAdded)lib.addPics();var wd=lib.imDiv.width();var ctop=40;var cleft=10;var ofs=lib.imDiv.offset();var oft=ofs.top;var ofl=ofs.left;$("#import").offset({top:oft+20,left:ofl+10});$("hr").offset({top:oft+50,left:ofl});var ln=lib.imEls.length;for(var i=0;i<ln;i++){ var el=lib.imDivs[i];el.hide();}
if(ln==0){var msg=$('<div id="msg">You have not yet imported any images</div>');lib.imDiv.append(msg);msg.offset({top:oft+ctop,left:ofl+20});}
for(var i=0;i<ln;i++){var el=lib.imDivs[i];var cim=lib.shownImages[i];if(!lib.hasTag(cim,lib.whichGallery)){el.hide();continue;}
el.show();var elwd=el.width();if((cleft+elwd)>wd){ ctop=ctop+lib.imHeight+lib.titleHt+lib.imPaddingY;cleft=10;}
var imel=lib.imEls[i];var elwd=el.width();var imwd=imel.width();var imoff=0.5*(elwd-imwd);el.offset({top:oft+ctop,left:ofl+cleft});imel.offset({top:oft+ctop+lib.titleHt,left:ofl+cleft+imoff});cleft=cleft+elwd+lib.imPaddingX;}
var tht=ctop+lib.imHeight+lib.titleHt+lib.imPaddingY;lib.imDiv.css({"height":tht+"px"});}
lib.renderContents=function(){lib.placePics();}
var cg="/image/4294b0e/"; lib.ordering=[cg+"the_dutch_proverbs",cg+"the_ambassadors",cg+"garden_of_earthly_delights",cg+"Saint_Francis_Bellini"]
lib.initialize=function(){var url="/api/allImages";util.commonInit();util.post(url,{},function(rs){$('document').ready(function(){lib.initialize2(rs);});});}
lib.initialize2=function(rs){var images=rs.value;var ibyt={};util.arrayForEach(images,function(im){var tp=im.topic;ibyt[tp]=im;});var oimages=[];var ino={};util.arrayForEach(lib.ordering,function(tp){var im=ibyt[tp];if(im){ino[tp]=1;oimages.push(im);}}); util.arrayForEach(images,function(im){var tp=im.topic;if(ino[tp])return;oimages.push(im);});images=oimages;util.commonInit()
lib.images=images;lib.shownImages=[];lib.filter="all"; lib.genDivs();lib.theLayout.placeDivs();lib.thePics=[];lib.imDiv=$(".imagesDiv");
lib.theLayout.afterPlacement=function(){lib.placePics();lib.lightbox=lib.theLayout.lightbox;};lib.tabGroup.selectElement(lib.whichGallery);var cDiv=lib.cDiv;cDiv.append('<div style="width:100;height:50px"></div>');lib.theLayout.placeDivs();$(window).resize(function(){util.log("resize",$(window).width());lib.theLayout.placeDivs();});return;}})();
